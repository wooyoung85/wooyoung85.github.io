> ğŸ¤¦â€â™‚ï¸ ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œëŠ” MetalLB ê°€ ë§ì´ ì‚¬ìš©ë˜ì§€ë§Œ í´ë¼ìš°ë“œ VM í™˜ê²½ì—ì„  ì§€ì›í•˜ì§€ ì•ŠìŒ  
> [https://metallb.universe.tf/installation/clouds/](https://metallb.universe.tf/installation/clouds/)

> ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œ ë¬¼ë¦¬ L4 ì¥ë¹„ë¥¼ `Ingress Controller` ì™€ ì—°ê²°í•´ì„œ Kubernetes ìƒì˜ ì„œë¹„ìŠ¤ë¥¼ ë…¸ì¶œí•˜ê¸°ë„ í•¨  
> ğŸ˜‰ ì‹¤ì œ L4 ì¥ë¹„ëŠ” ì—†ìœ¼ë‹ˆ ì‹¤ìŠµì—ì„œëŠ” `HAProxy` ì„¤ì¹˜í•˜ê¸°ë¡œ í•¨!!

# HAProxy Install & Config

```bash
mkdir -p /root/files/packages/haproxy
dnf download --resolve --destdir=/root/files/packages/haproxy --arch=x86_64 haproxy
dnf localinstall -y --disablerepo=\* /root/files/packages/haproxy/*.rpm

systemctl start haproxy
systemctl enable haproxy
systemctl status haproxy --no-pager
 
 
tee /etc/haproxy/haproxy.cfg <<- HAPROXY_CONFIG
#---------------------------------------------------------------------
# Global settings
#---------------------------------------------------------------------
global
    log         /dev/log    local0   debug
    chroot      /var/lib/haproxy
    pidfile     /var/run/haproxy.pid
    maxconn     4000
    user        haproxy
    group       haproxy
    daemon
 
#---------------------------------------------------------------------
# Default settings
#---------------------------------------------------------------------
defaults
    mode                    tcp                                    # ì¸ìŠ¤í„´ìŠ¤ê°€ ì²˜ë¦¬í•  í”„ë¡œí† ì½œ
    log                     global
    option                  tcplog                                 # TCP ë¡œê·¸ í¬ë§· ì‚¬ìš©
    option                  dontlognull                            # null connection(health checkìš© connection)ì— ëŒ€í•œ ë¡œê¹… í™œì„±í™”
    timeout connect         10s
    timeout client          30s                                    # clientì™€ì˜ ì—°ê²° ìµœëŒ€ ìœ ì§€ ì‹œê°„
    timeout server          30s                                    # serverì™€ì˜ ì—°ê²° ìµœëŒ€ ìœ ì§€ ì‹œê°„
 
#---------------------------------------------------------------------
# Frontend configuration for HTTP
#---------------------------------------------------------------------
frontend http_front
    bind *:80
    default_backend http_back
 
#---------------------------------------------------------------------
# Backend configuration for HTTP
#---------------------------------------------------------------------
backend http_back
    balance roundrobin
    server web1 127.0.0.1:31001 check
HAPROXY_CONFIG
 
echo "local0.*    /var/log/haproxy.log" | sudo tee /etc/rsyslog.d/10-haproxy.conf
systemctl restart rsyslog

systemctl restart haproxy
systemctl status haproxy --no-pager
```

# Nginx Ingress Controller Install

```bash
mkdir -p /root/files/ingress
curl -L https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.11.3/deploy/static/provider/baremetal/deploy.yaml -o /root/files/ingress/ingress-nginx-deploy.yaml
 
sed -i '/^    targetPort: http$/a \    nodePort: 31001' /root/files/ingress/ingress-nginx-deploy.yaml
sed -i '/^    targetPort: https$/a \    nodePort: 31002' /root/files/ingress/ingress-nginx-deploy.yaml
 
kubectl apply -f /root/files/ingress/ingress-nginx-deploy.yaml
kubectl get svc -n ingress-nginx
sleep 40;
```



> ### ğŸ¤·â€â™‚ï¸ Istio Ingress Gatewayë¥¼ ë°”ë¡œ ì‚¬ìš©í•˜ë©´ ë˜ëŠ”ë° êµ³ì´ Ingress Controllerë¥¼ ì•ì— ë°°ì¹˜í•œ ì´ìœ   
> - Kubeflowì—ì„œ IstioëŠ” ì—¬ëŸ¬ ì»´í¬ë„ŒíŠ¸(notebook, pipeline, Katib, KServe ë“±)ì˜ ì•ë‹¨ì—ì„œ ì¸ì¦ì„ í†µí•©ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ì§€ë§Œ Support System(Keycloak, Object Storage, Portal ë“±)ë“¤ì€ ìì²´ ì¸ì¦ ì²´ê³„ë¥¼ ê°–ì¶”ê³  ìˆìŒ ğŸ‘‰ Support System ì€ ì¸ì¦ì„ ìœ„í•´ Istioê°€ ë”°ë¡œ í•„ìš”ì—†ìŒ
> - ì‹¤ì œ í”„ë¡œì íŠ¸ í™˜ê²½ì—ì„œ Support System ë“¤ì€ ì¸í”„ë¼ ìì› ë° ë„ë©”ì¸ë„ ë‹¤ë¥¸ ì™„ì „ ë³„ë„ì˜ ì‹œìŠ¤í…œì¼ í™•ë¥ ì´ ë†’ìŒ
> - ì‹¤ìŠµ í™˜ê²½ì€ í•˜ë‚˜ì˜ í´ëŸ¬ìŠ¤í„°ë¥¼ ê³µìœ í•˜ì§€ë§Œ ë³„ë„ êµ¬ì„±ì´ë¼ëŠ” ì»¨ì…‰ì„ ì‚´ë¦¬ê¸° ìœ„í•´ ì•„ë˜ì™€ ê°™ì€ ë„¤íŠ¸ì›Œí¬ íë¦„ì„ ì„¤ê³„í•¨  
> **Kubeflow** : `Ingress Controller > Ingress > Istio Ingress Gateway > Gateway > Virtual Service > Service`  
> **Support System** : `Ingress Controller > Ingress > Service`



# Kubeflow Ingress ì„¤ì • 

```bash
cat <<EOF | tee ~/kf-ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: kf-ingress
  namespace: istio-system
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /  # ìš”ì²­ ê²½ë¡œë¥¼ ë¦¬ë‹¤ì´ë ‰íŠ¸
    nginx.ingress.kubernetes.io/proxy-body-size: "1gb"    
spec:
  ingressClassName: "nginx"  # NGINX Ingress Controller ì‚¬ìš©
  rules:
  - http:
      paths:
      - pathType: Prefix
        path: /
        backend:
          service:
            name: istio-ingressgateway
            port:
              number: 80
EOF
kubectl apply -f ~/kf-ingress.yaml
```
